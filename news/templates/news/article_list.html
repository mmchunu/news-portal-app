{% extends "news/base.html" %}

{% block title %}Articles{% endblock %}

{% block content %}

<h1>Articles</h1>

<!-- Show "Create Article" button if user has permission -->
{% if user.is_authenticated and perms.news.add_article %}
    <a href="{% url 'article_create' %}" class="btn btn-primary mb-2">Create New Article</a>
{% endif %}

<hr>

<!-- Loop through all articles -->
{% for article in articles %}
    <div class="article-card">

        <!-- Article Title -->
        <h2>{{ article.title }}</h2>

        <!-- Pending Approval -->
        {% if not article.is_approved %}
            <span class="pending">(Pending Approval)</span>
        {% endif %}

        <!-- Author -->
        <p>
            <strong>Author:</strong>
            <a href="{% url 'journalist_detail' article.author.pk %}" class="link">
                {{ article.author.username }}
            </a>
        </p>

        <!-- Publisher -->
        <p>
            <strong>Publisher:</strong>
            {% if article.publisher %}
                <a href="{% url 'publisher_detail' article.publisher.pk %}" class="link">
                    {{ article.publisher.name }}
                </a>
            {% else %}
                Independent
            {% endif %}
        </p>

        <!-- Published Date/Time -->
        <p>
            <strong>Published:</strong>
            {% if article.published_at %}
                {{ article.published_at|date:"F d, Y - g:i A" }}
            {% else %}
                Not published yet
            {% endif %}
        </p>

        <!-- Article Action Buttons -->
        <div class="article-buttons">

            <!-- View Article -->
            {% if user.is_authenticated %}
                <a href="{% url 'article_detail' article.pk %}" class="btn btn-primary">View Article</a>
            {% else %}
                <a href="{% url 'login' %}?next={% url 'article_detail' article.pk %}" class="btn btn-secondary">
                    View Article (Login Required)
                </a>
            {% endif %}

            <!-- Approve Article -->
            {% if article.can_approve %}
                <a href="{% url 'article_approve' article.pk %}" class="btn btn-success">Approve Article</a>
            {% endif %}

            <!-- Edit Article -->
            {% if article.can_edit %}
                <a href="{% url 'article_update' article.pk %}" class="btn btn-primary">Edit Article</a>
            {% endif %}

            <!-- Delete Article -->
            {% if article.can_delete %}
                <a href="{% url 'article_delete' article.pk %}" class="btn btn-danger">Delete Article</a>
            {% endif %}

        </div>

    </div>
    <hr>
{% empty %}
    <p>No articles available.</p>
{% endfor %}

{% endblock %}