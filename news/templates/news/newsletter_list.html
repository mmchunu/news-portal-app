{% extends "news/base.html" %}

{% block title %}Newsletters{% endblock %}

{% block content %}

<h1>Newsletters</h1>

<!-- Create Newsletter Button (Editors & Journalists Only) -->
{% if user.is_authenticated and user.role != "reader" %}
    <a href="{% url 'newsletter_create' %}" class="btn btn-primary">
        Create Newsletter
    </a>
{% endif %}

<hr>

<!-- Loop through newsletters -->
{% for newsletter in newsletters %}
    <div class="newsletter-card">
        <h2>{{ newsletter.title }}</h2>

        <!-- Publisher -->
        <p>
            <strong>Publisher:</strong>
            {% if newsletter.publisher %}
                <a href="{% url 'publisher_detail' newsletter.publisher.pk %}" class="link-primary">
                    {{ newsletter.publisher.name }}
                </a>
            {% else %}
                Independent
            {% endif %}
        </p>

        <!-- Published Date -->
        <p>
            <strong>Published:</strong>
            {% if newsletter.published_at %}
                {{ newsletter.published_at|date:"F d, Y - g:i A" }}
            {% else %}
                Not published yet
            {% endif %}
        </p>

        <!-- View Newsletter Button -->
        {% if user.is_authenticated %}
            <a href="{% url 'newsletter_detail' newsletter.pk %}" class="btn btn-info">
                View Newsletter
            </a>
        {% else %}
            <a href="{% url 'login' %}?next={% url 'newsletter_detail' newsletter.pk %}" class="btn btn-secondary">
                View Newsletter (Login Required)
            </a>
        {% endif %}

        <hr>
    </div>
{% empty %}
    <p>No newsletters available.</p>
{% endfor %}

{% endblock %}